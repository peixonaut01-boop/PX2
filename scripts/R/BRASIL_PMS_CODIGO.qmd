---
title: "Brasil Macro Atividade"
subtitle: "Pesquisa Mensal de Serviços (PMS)"
author: "Coloque seu nome aqui"
date: now
toc: true 
toc_float:
      collapsed: yes
      smooth_scroll: yes
theme: cosmo
format: 
  html:
    embed-resources: true
    fig-width: 7
    fig-height: 6
    fig-dpi: 100
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r functions_packages}
#| echo: false
#| warning: false 

options(repos = c(CRAN = "https://cloud.r-project.org/"))


# Pacotes necessários
packages <- c("ggplot2", "openxlsx", "lubridate", "purrr", "zoo", "RcppRoll",  "reshape2", "readxl", "dplyr", "ggrepel", "tibble",
              "stringi")

# Instalando pacotes ausentes
installed_packages <- packages %in% rownames(installed.packages())
if (any(!installed_packages)) {
  install.packages(packages[!installed_packages])
}

# Carregando pacotes
invisible(lapply(packages, library, character.only = TRUE))

# Definição da paleta de cores

palette <- c("#C38961FF", "#9F5630FF", "#E04B28FF", "#950404FF", 
             "#0F542FFF", "#388F30FF", "#004042FF",  "#00a3b4") %>% rev()

# Função para gráfico de barras
bar.plot <- function(df, label, title, subtitle, source, palette) {
  
  theme_set(theme_bw())
  colnames(df)[1] <- "Dates"
  last_month <- format(df[nrow(df), 1], '%b-%Y')
  
  ggplot(df %>% melt(id.vars = "Dates"), aes(x = Dates, y = value, fill = variable)) +
    geom_bar(position = "dodge", stat = "identity", alpha = 0.75) +
    labs(y = NULL, x = NULL, title = title, 
         subtitle = paste0(subtitle, last_month),
         caption = source) +
    theme(legend.position = 'bottom',
         axis.text.y=element_text(size=13),
         axis.text.x=element_text(size=13, angle = 90, 
                                     vjust = 0.5, hjust = 1),
          legend.text = element_text(size = 14),
          plot.title = element_text(size = 16),
          plot.subtitle = element_text(size = 13),
          plot.caption = element_text(hjust = 0, size = 13)) +
    geom_text(aes(label = value, colour = variable), vjust = -0.5 ) +
    scale_color_manual(name = NULL, values = palette[1:length(label)]) +
    scale_fill_manual(name = NULL, values = palette[1:length(label)], label = label) +
    scale_x_date(date_breaks = "4 months", date_labels ="%b-%y") +
    guides(colour = FALSE)
}

# Função para gráfico de linhas
line.plot <- function(df, title, subtitle, label, source, palette, last = FALSE) {
  
  theme_set(theme_bw())
  colnames(df)[1] <- "Dates"
  last_month <- format(df[nrow(df), 1], '%b-%Y')
  
  plot <- ggplot(melt(df, id.vars = "Dates"), aes(x = Dates, y = value, colour = variable)) +
    geom_line(linetype = 1, size = 1) +
    labs(y = NULL, x = NULL, title = title, 
         subtitle = paste0(subtitle, last_month),
         caption = source) +
    theme(legend.position = 'bottom',
           axis.text.y=element_text(size=13),
          axis.text.x=element_text(size=13, 
                                   angle = 90, vjust = 0.5, hjust = 1),
          legend.text = element_text(size = 14),
          plot.title = element_text(size = 16),
          plot.subtitle = element_text(size = 13),
          plot.caption = element_text(hjust = 0, size = 13)) +
    scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
    scale_colour_manual(name = NULL, values = palette[1:length(label)], label = label)
  
  if (last) {
    last_values <- df %>% slice(nrow(.)) %>% mutate(across(-1, ~ round(., 2))) %>% melt(id.vars = "Dates")
    plot <- plot +
      geom_text_repel(aes(label = value), data = last_values, size = 3, 
                      col = palette[1:length(label)], vjust = 1.5, hjust = -0.5)
  }
  
  return(plot)
}

# Função para gráfico de barras invertido
flip.bar.plot <- function(df, title, subtitle, source, palette) {
  
  theme_set(theme_bw())
  last_obs <- format(df[nrow(df), 1], '%b-%Y')
  
  df <- df %>% slice(nrow(.)) %>% t() %>% as.data.frame() %>%
    rownames_to_column(var = "Variable") %>% rename(Values = V1) %>%
    slice(-1) %>% mutate(Values = as.numeric(Values))
  
  ggplot(df, aes(x = reorder(Variable, -Values), y = Values)) +
    geom_bar(stat = "identity", fill = palette[1]) +
    coord_flip() +
    geom_text(aes(label = Values), col = palette[2], hjust = -0.2) +  
    labs(y = NULL, x = NULL, title = title, 
         subtitle = paste0(subtitle, last_obs),
         caption = source) +
    theme(legend.position = 'bottom',
          axis.text = element_text(size = 13),
          legend.text = element_text(size = 14),
          plot.title = element_text(size = 16),
          plot.subtitle = element_text(size = 13),
          plot.caption = element_text(hjust = 0, size = 13))
}

# Função para gráfico de sazonalidade
seasonality.plot <- function(data, year_range, selected_years, title, subtitle, source, palette) {
  
  theme_set(theme_bw())
                            
  palette<-palette
  raw<-data
  year_range <- year_range
  selected_years <- selected_years %>% sort(decreasing=T)
  title<-title
  subtitle<-subtitle
  source<-source
  
  last.month<-data[nrow(data),1] %>% format(., '%b-%Y')
  
    # Ensure column names
  names(raw)[1:2] <- c("Date", "Value")
  
  # Prepare the data with Year and Month columns

  raw <- raw %>%
    mutate(Month = lubridate::month(Date, label = TRUE, abbr = TRUE),
           Year = lubridate::year(Date)) 
  
  df<-raw %>%
    filter(Year >= min(year_range) & Year <= max(year_range))
  
  seq.date<-seq.Date(ymd('2000-01-01'),ymd('2000-12-01'), by="month")
                     
  # Calculate median, 10th and 90th percentiles for each month
  
  seasonal_stats <- df %>%
    group_by(Month) %>%
    summarise(median = median(Value, na.rm = TRUE),
              p10 = quantile(Value, 0.0, na.rm = TRUE),
              p90 = quantile(Value, 1.0, na.rm = TRUE)) %>%
    mutate(Month=seq.date)
  
  # Filter data for the selected years to plot their individual lines
  selected_data <- raw %>%
    filter(Year %in% selected_years)
  
  year(selected_data$Date)<-seq.date[1] %>% year()
  
  # Create the plot
  ggplot() +
    geom_ribbon(data = seasonal_stats, aes(x = Month, ymin = p10, ymax = p90), 
                fill = "steelblue2", alpha = 0.1)  +
    geom_line(data = seasonal_stats, aes(x = Month, y = median), 
              linetype = "dashed", color = "black", size = 1) +
    scale_x_date(date_breaks = "1 month", date_labels ="%b") +
    geom_line(data = selected_data, aes(x = Date, y = Value, 
                                        color = as.factor(Year)), size = 1) +
    # Add markers (diamond shapes) to the selected years
    geom_point(data = selected_data, aes(x = Date, y = Value, 
                                         color = as.factor(Year)), 
               size = 3, shape = 18) +
    labs(
      y=NULL,  
      x=NULL,
      title=paste0(title), 
      subtitle= paste0(
      subtitle, paste(" e mediana, max-min para", 
                         min(year_range), "-", max(year_range))," | Última leitura: ", 
                       last.month),
      caption = paste0( source)
      )  +
    theme(legend.position = 'bottom',
          axis.text.y=element_text(size=13),
          axis.text.x=element_text(size=13),
          legend.text = element_text(size=14),
          plot.title = element_text(size=16),
          plot.subtitle = element_text(size=13),
          plot.caption = element_text(hjust=0,size=13)
    ) +
   scale_color_manual(
     name = NULL, values = palette[length(selected_years):1]) 
  
  #+
  #  geom_hline(yintercept = 0, lty=2, alpha=0.2)
  

}

```

```{r download_dados}
#| echo: false
#| warning: false 

# Baixando dados do sidra (Volume/Receita Real SA e NSA)

# Volume por atividades com ajuste sazonal (SA) 

url<-"https://sidra.ibge.gov.br/geratabela?format=xlsx&name=tabela8688.xlsx&terr=N&rank=-&query=t/8688/n1/all/v/7168/p/all/c11046/56726/c12355/all/d/v7168%205/l/,c12355%2Bc11046,p%2Bt%2Bv"

# Arquivo temporário para armazenar o download 

destfile <- tempfile(fileext = ".xlsx")

# Download do arquivo: mode "wb" permite download binário

download.file(url, destfile, mode = "wb") 

vol.sa <- readxl::read_excel(destfile, skip=2) %>%
  slice(-c(1, nrow(.))) %>%
  select(-c(1:3)) %>%
  mutate(Dates=seq.Date(from=lubridate::ymd("2011-01-01"), by="month", length=nrow(.))) %>%
  relocate(Dates) %>%
  mutate_at(vars(-1), ~ as.numeric(.))

# Volume por atividades sem ajuste sazonal (NSA) 

url<-"https://sidra.ibge.gov.br/geratabela?format=xlsx&name=tabela8688.xlsx&terr=N&rank=-&query=t/8688/n1/all/v/7167/p/all/c11046/56726/c12355/all/d/v7167%205/l/,c12355%2Bc11046,p%2Bt%2Bv"

# Arquivo temporário para armazenar o download 

destfile <- tempfile(fileext = ".xlsx")

# Download do arquivo: mode "wb" permite download binário

download.file(url, destfile, mode = "wb") 

vol.nsa <- readxl::read_excel(destfile, skip=2) %>%
  slice(-c(1, nrow(.))) %>%
  select(-c(1:3)) %>%
  mutate(Dates=seq.Date(from=lubridate::ymd("2011-01-01"), by="month", length=nrow(.))) %>%
  relocate(Dates) %>%
  mutate_at(vars(-1), ~ as.numeric(.))

# Receita nominal por atividades sem ajuste sazonal (NSA) 

url<-"https://sidra.ibge.gov.br/geratabela?format=xlsx&name=tabela8688.xlsx&terr=N&rank=-&query=t/8688/n1/all/v/7167/p/all/c11046/56725/c12355/all/d/v7167%205/l/,c12355%2Bc11046,p%2Bt%2Bv"

# Arquivo temporário para armazenar o download 

destfile <- tempfile(fileext = ".xlsx")

# Download do arquivo: mode "wb" permite download binário

download.file(url, destfile, mode = "wb") 

nom.nsa <- readxl::read_excel(destfile, skip=2) %>%
  slice(-c(1, nrow(.))) %>%
  select(-c(1:3)) %>%
  mutate(Dates=seq.Date(from=lubridate::ymd("2011-01-01"), by="month", length=nrow(.))) %>%
  relocate(Dates) %>%
  mutate_at(vars(-1), ~ as.numeric(.))

```

```{r tratamento_dados}
#| echo: false
#| warning: false 

## Tratamento dos dados brutos: transformações mensais (MoM), interanuais (YoY) e construção dos deflatores

# MoM%-SA e YoY%-NSA 

all.mom<-vol.sa %>%
  mutate_at(vars(-1), ~ 100*(./lag(., n = 1) -1)) %>%
  mutate_at(vars(-1), ~ round(., digits=2))

all.mom.nsa<-vol.nsa %>%
  mutate_at(vars(-1), ~ 100*(./lag(., n = 1) -1)) %>%
  mutate_at(vars(-1), ~ round(., digits=2))

all.mom.nom.nsa<-nom.nsa %>%
  mutate_at(vars(-1), ~ 100*(./lag(., n = 1) -1)) %>%
  mutate_at(vars(-1), ~ round(., digits=2))

all.yoy<-vol.nsa  %>%
  mutate_at(vars(-1), ~ 100*(./lag(., n = 12) -1)) %>%
  mutate_at(vars(-1), ~ round(., digits=2))

all.yoy.nom<-nom.nsa  %>%
  mutate_at(vars(-1), ~ 100*(./lag(., n = 12) -1)) %>%
  mutate_at(vars(-1), ~ round(., digits=2))

all.qoq<-vol.sa %>%
  mutate_at(vars(-1), ~ zoo::rollmean(., k=3, fill=NA, align='right')) %>%
  mutate_at(vars(-1), ~ 100*(./lag(., n = 3)-1)) %>%
  mutate_at(vars(-1), ~ round(., digits=2))

## Construção dos deflatores

# Copiando a estrutura de um conjunto de dados original 

deflatores <- all.mom.nsa 

# Computando o deflator implícito, métrica mensal NSA

deflatores[-1] <- purrr::map2_dfc(all.mom.nom.nsa[-1], all.mom.nsa[-1],  ~ round(100 * ((1 + .x / 100) / (1 + .y / 100) - 1), 2))

deflatores.yoy<- deflatores %>%
  mutate_at(vars(-1),
            ~ (roll_prodr(1+./100, n=12)-1)*100)


```

# Resumo

::::: panel-tabset
## Mensal

::: panel-tabset
### Por categoria

```{r resumo_mensal , fig.width=9, fig.height=7}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - Aberturas")

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom  %>% select(., c(Dates, 2,3,
                         8,
                         13,
                         18,
                         26)) %>% 
  stats::setNames(c("Dates", "Serviços Totais",
                    "Serviços prestados às famílias",
                    "Informação e comunicação",
                    "Profissionais, administrativos e complementares",
                    "Transportes",
                    "Outros serviços")) %>%
  as.data.frame() %>%
  flip.bar.plot(., 
                title=title,
                subtitle=subtitle,
                source=source,
                palette=palette)

```

### Por atividade

```{r resumo_mensal_poratividade , fig.width=9, fig.height=7}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - Por atividade")

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates ,2,4,7,
                         10:12,
                         14,15:17,
                         19,23,24,25,
                         26)) %>% 
  stats::setNames(c("Dates", substr(colnames(.)[-1], 1, 35)))  %>%
  as.data.frame() %>%
  flip.bar.plot(., 
                title=title,
                subtitle=subtitle,
                source=source,
                palette=palette)

```
:::

## Trimestral

::: panel-tabset
### Por categoria

```{r resumo_trimestral , fig.width=9, fig.height=7}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - Aberturas")

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq  %>% select(., c(Dates, 2,3,
                         8,
                         13,
                         18,
                         26)) %>% 
  stats::setNames(c("Dates", "Serviços Totais",
                    "Serviços prestados às famílias",
                    "Informação e comunicação",
                    "Profissionais, administrativos e complementares",
                    "Transportes",
                    "Outros serviços")) %>%
  as.data.frame() %>%
  flip.bar.plot(., 
                title=title,
                subtitle=subtitle,
                source=source,
                palette=palette)

```

### Por atividade

```{r resumo_trimestral_poratividade , fig.width=9, fig.height=7}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - Por atividade")

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq %>% select(., c(Dates ,2,4,7,
                         10:12,
                         14,15:17,
                         19,23,24,25,
                         26)) %>% 
  stats::setNames(c("Dates", substr(colnames(.)[-1], 1, 35)))  %>%
  as.data.frame() %>%
  flip.bar.plot(., 
                title=title,
                subtitle=subtitle,
                source=source,
                palette=palette)

```
:::

## Difusão

```{r difusao_sa}
#| echo: false
#| warning: false 

label<-c("Difusão", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - Difusão SA")

subtitle<-paste0("% SA | Última Leitura: ")

difusao<-all.mom %>% select(., c("Dates", 4,7,10,11,12,14,16,17,19,23,24,25,26)) %>%
  mutate(
    Diffusion_Index = rowMeans(select(., -Dates) > 0, na.rm = TRUE)
    )

difusao  %>%
  select(., c(Dates, ncol(.))) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) 
  



```

## Difusão (zoom)

```{r difusao_sa_zoom}
#| echo: false
#| warning: false 

label<-c("Difusão")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - Difusão SA")

subtitle<-paste0("% SA | Última Leitura: ")

difusao  %>%
  select(., c(Dates, ncol(.))) %>%
  filter(Dates>=ymd("2023-01-01")) %>%
  mutate_at(vars(-1), ~ round(., digits=2)) %>%
  as.data.frame() %>% 
  bar.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) +
  coord_cartesian(ylim=c(0,1))
  



```

## Nível

```{r nivel_todascategorias}
#| echo: false
#| warning: false 

label<-c("Total","Famílias", "Informação e Comun.", "Profissionais", "Transportes", "Outros Serviços")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - Todas as categorias (Dec/19)=100") 

subtitle<-paste0("Nível SA | Última Leitura: ")

vol.sa %>% 
  select(., c(Dates, 2,3,8,13,18,26))  %>%
  filter(Dates>=ymd("2012-01-01")) %>% 
  mutate_at(vars(-1), ~ 100*(./.[which(Dates=="2019-12-01")])) %>%
  mutate_at(vars(-1), ~ round(., digits=0)) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T)  



```
:::::

# Serviços Totais

::: panel-tabset
## Nivel

```{r total_nivel}
#| echo: false
#| warning: false 

indic<-c("Total" )

label<-c("Total", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=F) 



```

## MoM

```{r total_mom}
#| echo: false
#| warning: false 

indic<-c("Total")

label<-c("Total")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## QoQ

```{r total_qoq}
#| echo: false
#| warning: false 

indic<-c("Total")

label<-c("Total")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## YoY

```{r total_yoy}
#| echo: false
#| warning: false 

label<-c(label[1], "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2012-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) +
  coord_cartesian(ylim=c(-15,15))



```

## Deflator

```{r total_deflator}
#| echo: false
#| warning: false 

indic<-c("Total")

label<-indic

title<-paste0("PMS | Deflator - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% 
  seasonality.plot(., 
                   year_range = year_range,
                   selected_years =selected_years,
                   title=title, 
                   subtitle=subtitle,
                   source=source,
                   palette=palette )




```
:::

# Serviços às Famílias

::::: panel-tabset
## Nivel

```{r familias_nivel}
#| echo: false
#| warning: false 

indic<-c("1. Serviços prestados às famílias" )

label<-c("Serviços às famílias", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")


             
vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```

## MoM

```{r familias_mom}
#| echo: false
#| warning: false 

indic<-c("1. Serviços prestados às famílias" )

label<-"Serviços às famílias"

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source,palette=palette)

```

## QoQ

```{r familias_qoq}
#| echo: false
#| warning: false 


source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## YoY

```{r familias_yoy}
#| echo: false
#| warning: false 

label<-c(label[1], "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2012-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) +
  coord_cartesian(ylim = c(-10,10))


```

## Deflator

```{r familias_deflator}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Deflator - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., 
                                       year_range = year_range,
                                       selected_years =selected_years,
                                       title=title,
                                       subtitle=subtitle, 
                                       source=source,
                                       palette=palette)



```

## Alojamento e Alimentação

::: panel-tabset
### Nivel

```{r alojalim_nivel}
#| echo: false
#| warning: false 

indic<-c("1.1 Serviços de alojamento e alimentação" )

label<-c("Alojamento e alimentação", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```

### MoM

```{r alojalim_mom}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source,palette=palette)

```
:::

## Outros serviços às famílias

::: panel-tabset
### Nivel

```{r outrosfam_nivel}
#| echo: false
#| warning: false 

indic<-c("1.2 Outros serviços prestados às famílias" )

label<-c("Outros serviços prestados às famílias", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```

### MoM

```{r outrosfam_mom}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source,
           palette=palette)

```
:::
:::::

# Informação e Comunicação

::::: panel-tabset
## Nivel

```{r info_nivel}
#| echo: false
#| warning: false 

indic<-c("2. Serviços de informação e comunicação" )

label<-c("Informação e comunicação", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 


```

## MoM

```{r info_mom}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source,
           palette=palette)

```

## QoQ

```{r info_qoq}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## YoY

```{r info_yoy}
#| echo: false
#| warning: false 

label<-c(label[1], "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2012-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) +
  coord_cartesian(ylim = c(-10,15))


```

## Deflator

```{r info_deflator}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Deflator - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette)



```

## Tecnologia de Informação e Comunicação

::: panel-tabset
### Nivel

```{r teccom_nivel}
#| echo: false
#| warning: false 

indic<-c("2.1 Serviços de Tecnologia de Informação e Comunicação (TIC)", "2.1.1 Telecomunicações", "2.1.2 Serviços de Tecnologia da Informação" )

label<-c("TI e Comunicação (TIC)", "Telecomunicações", "Serviços de TI")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")


             
vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate_at(vars(-1), ~ 100*(./.[which(Dates=="2019-12-01")])) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```

### MoM

```{r teccom_mom}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2024-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(.,             title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```
:::

## Audiovisuais

::: panel-tabset
### Nivel

```{r audio_nivel}
#| echo: false
#| warning: false 

indic<-c("2.2 Serviços audiovisuais, de edição e agências de notícias" )

label<-c("Serviços audiovisuais, de edição e agências de notícias", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")
             
vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```
:::
:::::

# Profissionais e Administrativos

::: panel-tabset
## Nivel

```{r prof_nivel}
#| echo: false
#| warning: false 

indic<-c("3. Serviços profissionais, administrativos e complementares" )

label<-c("Serviços profissionais, administrativos e complementareso", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 


```

## MoM

```{r prof_mom}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## QoQ

```{r prof_qoq}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## YoY

```{r prof_yoy}
#| echo: false
#| warning: false 

label<-c(label[1], "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) +
  coord_cartesian(ylim = c(-15,15))


```

## Deflator

```{r prof_deflator}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Deflator - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```

## Técnico-Profissional

```{r tecnico_nivel}
#| echo: false
#| warning: false 

indic<-c("3.1 Serviços técnico-profissionais" )

label<-c("Serviços técnico-profissionais", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```

## Serviços Adm. e complementares

```{r admcomplementares_nivel}
#| echo: false
#| warning: false 

indic<-c("3.2 Serviços administrativos e complementares",
         "3.2.1 Aluguéis não imobiliários",
         "3.2.2 Serviços de apoio às atividades empresariais")

label<-c("Administrativos e comp.", "Aluguéis não-imob.", "Apoio atividades empres.")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")


             
vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate_at(vars(-1), ~ 100*(./.[which(Dates=="2019-12-01")])) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```
:::

# Transportes

::::: panel-tabset
## Nivel

```{r transp_nivel}
#| echo: false
#| warning: false 

indic<-c("4. Transportes, serviços auxiliares aos transportes e correio" )

label<-c("Transportes, serviços auxiliares aos transportes e correio", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 


```

## MoM

```{r transp_mom}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## QoQ

```{r transp_qoq}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## YoY

```{r transp_yoy}
#| echo: false
#| warning: false 

label<-c(label[1], "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) +
  coord_cartesian(ylim = c(-15,20))


```

## Deflator

```{r transp_deflator}
#| echo: false
#| warning: false 


label<-label[1]

title<-paste0("PMS | Deflator - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```

## Terrestre

::: panel-tabset
### Nivel

```{r transpterrestre_nivel}
#| echo: false
#| warning: false 

indic<-c("4.1 Transporte terrestre" )

label<-c("Transporte terrestre", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")
             
vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```

### MoM

```{r transpterrestre_mom}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

### QoQ

```{r transpterrestre_qoq}
#| echo: false
#| warning: false 

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("QoQ%-SA | Última Leitura: ")

all.qoq %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

### Deflator

```{r transpterrestre_deflator}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Deflator - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```
:::

## Aéreo

::: panel-tabset
### Nivel

```{r aereo_nivel}
#| echo: false
#| warning: false 

indic<-c("4.3 Transporte aéreo" )

label<-c("Transporte aéreo", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")


             
vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```

### MoM

```{r aereo_mom}
#| echo: false
#| warning: false 


source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

### Deflator

```{r aereo_deflator}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Deflator  - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```
:::

## Aquaviario e Armazenagem

```{r aqua_armazenagem_nivel}
#| echo: false
#| warning: false 

indic<-c("4.2 Transporte aquaviário",
         "4.4 Armazenagem, serviços auxiliares aos transportes e correio" )

label<-c("Aquaviário", "Armazenagem, serviços auxiliares aos transportes e correio")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label, collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate_at(vars(-1), ~ 100*(./.[which(Dates=="2019-12-01")])) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 



```
:::::

# Outros Serviços

::::::: panel-tabset
## Nivel

```{r outros_nivel}
#| echo: false
#| warning: false 

indic<-c("5. Outros serviços" )

label<-c("Outros serviços", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("Nivel SA | Última Leitura: ")

          
vol.sa %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 


```

## MoM

```{r outros_mom}
#| echo: false
#| warning: false 


source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-SA | Última Leitura: ")

all.mom %>% select(., c(Dates, indic)) %>% 
  filter(Dates>=ymd("2023-01-01")) %>% 
  as.data.frame() %>%
  bar.plot(., 
           title=title, subtitle=subtitle, label=label, source=source, palette=palette)

```

## YoY

```{r outros_yoy}
#| echo: false
#| warning: false 

label<-c(label[1], "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2011-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) +
  coord_cartesian(ylim = c(-15,20))


```

## Deflator

```{r outros_deflator}
#| echo: false
#| warning: false 


label<-label[1]

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA | Última Leitura: ")

selected_years<-c(2023:2025)

year_range = c(2011, 2019)

deflatores %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```

## Esgoto, gestão de resíduos

::: panel-tabset
### YoY

```{r esgoto_yoy}
#| echo: false
#| warning: false 

indic<-c("5.1 Esgoto, gestão de resíduos, recuperação de materiais e descontaminação" )

label<-c("Esgoto, gestão de resíduos, recuperação de materiais e descontaminação", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2020-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) 


```

### MoM%-NSA

```{r esgoto_momsa}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA | Última Leitura: ")

selected_years<-c(2023:2025)

year_range = c(2011, 2022)

all.mom.nsa %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```
:::

## Atividades auxiliares dos serviços financeiros

::: panel-tabset
### YoY

```{r ativfin_yoy}
#| echo: false
#| warning: false 

indic<-c("5.2 Atividades auxiliares dos serviços financeiros" )

label<-c("Atividades auxiliares dos serviços financeiros", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2020-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette) 


```

### MoM%-NSA

```{r ativfin_momsa}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA | Última Leitura: ")

selected_years<-c(2023:2025)

year_range = c(2011, 2022)

all.mom.nsa %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```
:::

## Atividades imobiliárias

::: panel-tabset
### YoY

```{r ativimob_yoy}
#| echo: false
#| warning: false 

indic<-c("5.3 Atividades imobiliárias" )

label<-c("Atividades imobiliárias", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2020-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) 


```

### MoM%-NSA

```{r ativimob_momsa}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA | Última Leitura: ")

selected_years<-c(2023:2025)

year_range = c(2011, 2022)

all.mom.nsa %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```
:::

## Outros serviços não especificados anteriormente

::: panel-tabset
### YoY

```{r outrosnaoespec_yoy}
#| echo: false
#| warning: false 

indic<-c("5.4 Outros serviços não especificados anteriormente")

label<-c("Outros serviços não especificados anteriormente", "MA(3)")

source<-c("Fonte: IBGE e elaboração do autor.")

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("YoY%-NSA | Última Leitura: ")

all.yoy %>% select(., c("Dates", indic)) %>%
  filter(Dates>=ymd("2020-01-01")) %>%
  mutate(ma3=zoo::rollmean(.[[2]], k=3, fill=NA, align='right')) %>%
  as.data.frame() %>% 
  line.plot(.,title=title, subtitle=subtitle,label=label, source=source, palette=palette, last=T) 


```

### MoM%-NSA

```{r outrosnaoespec_momsa}
#| echo: false
#| warning: false 

label<-label[1]

title<-paste0("PMS | Receita Real - ", paste(label[1], collapse = ", "))

subtitle<-paste0("MoM%-NSA | Última Leitura: ")

selected_years<-c(2023:2025)

year_range = c(2011, 2022)

all.mom.nsa %>% select(., c("Dates", indic)) %>%
  as.data.frame() %>% seasonality.plot(., year_range = year_range,
                                     selected_years =selected_years,
                                     title=title, 
                                     subtitle=subtitle,
                                     source=source,
                                     palette=palette
                                     )


```
:::
:::::::
